<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>append: to copy or not to copy | Arjun Mahishi</title><link rel="icon" href="/favicon.ico"/><meta name="description" content="Arjun Mahishi&#x27;s personal website"/><meta property="og:title" content="append: to copy or not to copy"/><meta property="og:description" content=""/><meta property="og:image" content="/img/dp.jpg"/><meta property="og:url" content="https://arjunmahishi.me"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@arjunmahishi"/><meta name="twitter:creator" content="@arjunmahishi"/><meta name="twitter:title" content="append: to copy or not to copy"/><meta name="twitter:description" content=""/><meta name="twitter:image" content="/img/dp.jpg"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link href="/gruvbox.css" rel="stylesheet"/><meta name="next-head-count" content="18"/><link rel="preload" href="/_next/static/css/0ca9c671cddff45b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0ca9c671cddff45b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-481ef0d25a716735.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8eb925bbcba34840.js" defer=""></script><script src="/_next/static/chunks/209-e125b2166f138b3f.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e4f4a3439303c917.js" defer=""></script><script src="/_next/static/txtJHpHMm2CmyqXAvT9P1/_buildManifest.js" defer=""></script><script src="/_next/static/txtJHpHMm2CmyqXAvT9P1/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><h1 class="flex justify-center text-4xl font-bold mb-4 mt-10"><a href="/">‡≤Ö‡≤∞‡≥ç‡≤ú‡≥Å‡≤®‡≥ç ‡≤Æ‡≤π‡≤ø‡≤∑‡≤ø</a></h1><nav class="flex justify-center"><ul class="flex gap-5"><li><a class="underline underline-offset-4 decoration-2" href="/about">About</a></li><li><a class="underline underline-offset-4 decoration-2" href="/projects">Projects</a></li><li><a class="underline underline-offset-4 decoration-2" href="/posts">Blog</a></li><li><a class="underline underline-offset-4 decoration-2" href="/vim-adventures">Vim-Adventures</a></li><li><a class="underline underline-offset-4 decoration-2" href="/maps">Maps</a></li></ul></nav></div><div class="flex mt-10 mb-7 justify-center"><h1 class="text-4xl font-bold">append: to copy or not to copy</h1></div><div class="flex lg:px-0 px-8 justify-between mb-4 border-b border-dashed border-gray-300" style="display:flex"><span>2025-02-04</span><span>3 min read</span></div><img alt="append: to copy or not to copy" class="lg:max-w-3xl rounded-xl mb-4" style="display:none"/><article class="prose lg:max-w-3xl lg:px-0 px-8 mb-4 sm:mb-8 leading-relaxed text-gray-800 mt-10"><html><head></head><body><h2 id="part-1"><a class="anchor" href="#part-1">Part 1</a></h2>
<p>I got to do some tricky string manipulation involving non-unicode characters
last week. While working on that, I came across an unexpected behaviour of the
<code>append</code> function in Go. Consider this code snippet:</p>
<div class="remark-highlight"><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	a <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'A'</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// A</span>

	b <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token char">'B'</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// A</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// AB</span>

	b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'C'</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// CB</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ??</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>What will the last print statement print? Try to guess it before running the
code. Here's a link to the playground if you want to run it: <a href="https://go.dev/play/p/MUrcymmITef">https://go.dev/play/p/MUrcymmITef</a></p>
<p>This is the output of the code:</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">A
A
AB
CB
C üëà WHAT!?</code></pre></div>
<p>I always assumed that <code>append</code> would create a new slice and copy the elements
from the original slice to the new one. But apparently, that's not the case.
Append only creates a new slice if the capacity of the original slice is less
than the required capacity. In this case, the capacity of the original slice is
4 and the required capacity is 2 (what <code>a</code> already has + 'B'). So, <code>append</code>
just appends the new element to the same underlying slice that <code>a</code> is pointing
to.</p>
<p>But if you see the second print statement, it prints <code>A</code> instead of <code>AB</code>. This
is because <code>a</code> only has access the first element of the underlying array. Pay attention to the <code>make</code> call.</p>
<div class="remark-highlight"><pre class="language-go"><code class="language-go">a <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The second argument to <code>make</code> is the length of the slice and the third argument
is the capacity of the slice. So, even though memory of 4 bytes is allocated, <code>a</code>
only has access to the first byte. When <code>append</code> is called, it appends the new
element to the underlying array and returns a new slice. But <code>a</code> still points
to the first element of the underlying array. That's why we don't see 'B' in the
second print statement.</p>
<p>We notice the mutation of <code>a</code> when we change the first element of <code>b</code> to 'C'. This
change is reflected in <code>a</code> as well. This is why the last print statement prints
<code>C</code>.</p>
<hr>
<h2 id="part-2"><a class="anchor" href="#part-2">Part 2</a></h2>
<p>Now, change the <code>make</code> call to <code>a := make([]byte, 4)</code> and run the code again.</p>
<div class="remark-highlight"><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	a <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'A'</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// A</span>

	b <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token char">'B'</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// A</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// AB</span>

	b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'C'</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// CB</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ??</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Go playground: <a href="https://go.dev/play/p/8phhB2NtZze">https://go.dev/play/p/8phhB2NtZze</a></p>
<p>This is the output of the code:</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">A
A
AB
CB
A</code></pre></div>
<p>This was the second TIL.</p>
<p>When you do <code>make([]byte, 1, 4)</code>, you allocate 4 bytes of memory. And initialize
the <strong>first byte to it's zero value</strong>.</p>
<p>When you do <code>make([]byte, 4)</code>, you allocate 4 bytes of memory. And initialize
<strong>all the bytes to their zero value</strong>. This leaves no memory for <code>append</code> to
reuse. So, <code>append</code> creates a new slice with the same length and capacity as
the original slice. This is why the last print statement prints <code>A</code>.</p>
<hr>
<p>I hope you found this as interesting as I did. This gave me a headache for a
while. But after figuring out the nuances, it felt good. I don't really have an
opinion on whether this behaviour is good or bad. But it's good to know that
this is how <code>append</code> works in Go.</p>
</body></html></article><footer class="text-center text-gray-500 text-sm mt-5 pb-2">Built from scratch with <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://nextjs.org/">Next.js</a> and <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://tailwindcss.com/">Tailwind CSS</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"append-behaviour","contentHTML":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003ch2 id=\"part-1\"\u003e\u003ca class=\"anchor\" href=\"#part-1\"\u003ePart 1\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eI got to do some tricky string manipulation involving non-unicode characters\nlast week. While working on that, I came across an unexpected behaviour of the\n\u003ccode\u003eappend\u003c/code\u003e function in Go. Consider this code snippet:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\ta \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token function\"\u003emake\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token builtin\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\ta\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'A'\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// A\u003c/span\u003e\n\n\tb \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token char\"\u003e'B'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// A\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// AB\u003c/span\u003e\n\n\tb\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'C'\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// CB\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// ??\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhat will the last print statement print? Try to guess it before running the\ncode. Here's a link to the playground if you want to run it: \u003ca href=\"https://go.dev/play/p/MUrcymmITef\"\u003ehttps://go.dev/play/p/MUrcymmITef\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is the output of the code:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eA\nA\nAB\nCB\nC üëà WHAT!?\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI always assumed that \u003ccode\u003eappend\u003c/code\u003e would create a new slice and copy the elements\nfrom the original slice to the new one. But apparently, that's not the case.\nAppend only creates a new slice if the capacity of the original slice is less\nthan the required capacity. In this case, the capacity of the original slice is\n4 and the required capacity is 2 (what \u003ccode\u003ea\u003c/code\u003e already has + 'B'). So, \u003ccode\u003eappend\u003c/code\u003e\njust appends the new element to the same underlying slice that \u003ccode\u003ea\u003c/code\u003e is pointing\nto.\u003c/p\u003e\n\u003cp\u003eBut if you see the second print statement, it prints \u003ccode\u003eA\u003c/code\u003e instead of \u003ccode\u003eAB\u003c/code\u003e. This\nis because \u003ccode\u003ea\u003c/code\u003e only has access the first element of the underlying array. Pay attention to the \u003ccode\u003emake\u003c/code\u003e call.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003ea \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token function\"\u003emake\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token builtin\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe second argument to \u003ccode\u003emake\u003c/code\u003e is the length of the slice and the third argument\nis the capacity of the slice. So, even though memory of 4 bytes is allocated, \u003ccode\u003ea\u003c/code\u003e\nonly has access to the first byte. When \u003ccode\u003eappend\u003c/code\u003e is called, it appends the new\nelement to the underlying array and returns a new slice. But \u003ccode\u003ea\u003c/code\u003e still points\nto the first element of the underlying array. That's why we don't see 'B' in the\nsecond print statement.\u003c/p\u003e\n\u003cp\u003eWe notice the mutation of \u003ccode\u003ea\u003c/code\u003e when we change the first element of \u003ccode\u003eb\u003c/code\u003e to 'C'. This\nchange is reflected in \u003ccode\u003ea\u003c/code\u003e as well. This is why the last print statement prints\n\u003ccode\u003eC\u003c/code\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"part-2\"\u003e\u003ca class=\"anchor\" href=\"#part-2\"\u003ePart 2\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eNow, change the \u003ccode\u003emake\u003c/code\u003e call to \u003ccode\u003ea := make([]byte, 4)\u003c/code\u003e and run the code again.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-go\"\u003e\u003ccode class=\"language-go\"\u003e\u003cspan class=\"token keyword\"\u003efunc\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\ta \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token function\"\u003emake\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token builtin\"\u003ebyte\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\ta\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'A'\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// A\u003c/span\u003e\n\n\tb \u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e \u003cspan class=\"token function\"\u003eappend\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token char\"\u003e'B'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// A\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// AB\u003c/span\u003e\n\n\tb\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token char\"\u003e'C'\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// CB\u003c/span\u003e\n\tfmt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003estring\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// ??\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eGo playground: \u003ca href=\"https://go.dev/play/p/8phhB2NtZze\"\u003ehttps://go.dev/play/p/8phhB2NtZze\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThis is the output of the code:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eA\nA\nAB\nCB\nA\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis was the second TIL.\u003c/p\u003e\n\u003cp\u003eWhen you do \u003ccode\u003emake([]byte, 1, 4)\u003c/code\u003e, you allocate 4 bytes of memory. And initialize\nthe \u003cstrong\u003efirst byte to it's zero value\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eWhen you do \u003ccode\u003emake([]byte, 4)\u003c/code\u003e, you allocate 4 bytes of memory. And initialize\n\u003cstrong\u003eall the bytes to their zero value\u003c/strong\u003e. This leaves no memory for \u003ccode\u003eappend\u003c/code\u003e to\nreuse. So, \u003ccode\u003eappend\u003c/code\u003e creates a new slice with the same length and capacity as\nthe original slice. This is why the last print statement prints \u003ccode\u003eA\u003c/code\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eI hope you found this as interesting as I did. This gave me a headache for a\nwhile. But after figuring out the nuances, it felt good. I don't really have an\nopinion on whether this behaviour is good or bad. But it's good to know that\nthis is how \u003ccode\u003eappend\u003c/code\u003e works in Go.\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e","title":"append: to copy or not to copy","date":"2025-02-04","tags":["golang"],"readTime":"3 min read"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"append-behaviour"},"buildId":"txtJHpHMm2CmyqXAvT9P1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>