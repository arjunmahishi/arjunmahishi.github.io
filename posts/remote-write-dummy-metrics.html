<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Remote Write Dummy Metrics | Arjun Mahishi</title><link rel="icon" href="/favicon.ico"/><meta name="description" content="Arjun Mahishi&#x27;s personal website"/><meta property="og:title" content="Remote Write Dummy Metrics"/><meta property="og:description" content=""/><meta property="og:image" content="/img/dp.jpg"/><meta property="og:url" content="https://arjunmahishi.me"/><meta property="og:type" content="blog"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@arjunmahishi"/><meta name="twitter:creator" content="@arjunmahishi"/><meta name="twitter:title" content="Remote Write Dummy Metrics"/><meta name="twitter:description" content=""/><meta name="twitter:image" content="/img/dp.jpg"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link href="/gruvbox.css" rel="stylesheet"/><meta name="next-head-count" content="18"/><link rel="preload" href="/_next/static/css/3af525f2385c6e08.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3af525f2385c6e08.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-481ef0d25a716735.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8eb925bbcba34840.js" defer=""></script><script src="/_next/static/chunks/209-e125b2166f138b3f.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-26e0ef4f8384786d.js" defer=""></script><script src="/_next/static/CvIparCNGMKE8_go-qcJd/_buildManifest.js" defer=""></script><script src="/_next/static/CvIparCNGMKE8_go-qcJd/_ssgManifest.js" defer=""></script></head><body><div id="__next">  <div class="grid place-items-center"><div class="flex flex-col items-center"><h1 class="text-center text-4xl font-bold mb-4"><a class="underline decoration-2 underline-offset-4" href="/">ಅರ್ಜುನ್ ಮಹಿಷಿ</a></h1><nav><ul class="flex flex-wrap justify-center gap-2"><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/about">About</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/projects">Projects</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/posts">Blog</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/vim-adventures">Vim-Adventures</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/maps">Maps</a></li></ul></nav></div><div class="prose lg:max-w-2xl px-8 m-auto my-4 sm:my-8"><h1 class="text-4xl font-bold mb-4 border-b pb-2">Remote Write Dummy Metrics</h1></div><img alt="Remote Write Dummy Metrics" class="lg:max-w-3xl rounded-xl" style="display:none"/><article class="prose lg:max-w-2xl px-8 m-auto mb-4 sm:mb-8 leading-relaxed text-gray-800"><html><head></head><body><p>While working on any system built on top of prometheus based storage, you might
want to use dummy data for testing. But prometheus based storages (prometheus,
victoriaMetrics, m3db etc) don’t support “insert” queries like SQL. So, this
doc will walk you through how to remote_write data into prometheus without
having to write any code</p>
<h2 id="setup"><a class="anchor" href="#setup">Setup</a></h2>
<ol>
<li>
<p>Make sure you have a tool that can spin up a simple HTTP server that can serve static files. <code>python</code> also will do</p>
</li>
<li>
<p>Install any prometheus based remote write agent</p>
<p>For <code>vmagent</code>, you can download the latest version of <code>vimutils</code> from this
<a href="https://github.com/VictoriaMetrics/VictoriaMetrics/releases">github release page</a>,
unarchive it and place the <code>vmagent</code> binary in your system PATH</p>
</li>
</ol>
<h2 id="steps"><a class="anchor" href="#steps">Steps</a></h2>
<ol>
<li>
<p>Create a file called <code>metrics</code> with the below contents. This is the dummy data we will be inserting into the storage. This is in the <strong>Open metrics format</strong> everyone is talking about</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">request_count{tag_namespace=&#x26;quot;alpha&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 30
request_count{tag_namespace=&#x26;quot;beta&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 20
request_count{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 10
request_count{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;us-east-1&#x26;quot;} 10
error{tag_namespace=&#x26;quot;alpha&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 1
error{tag_namespace=&#x26;quot;beta&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 0
error{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;us-east-1&#x26;quot;} 4</code></pre></div>
</li>
<li>
<p>Run an HTTP server that can server this file on <code>/metrics</code></p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> to/dir/containing/above/file
$ python <span class="token parameter variable">-m</span> http.server <span class="token number">9000</span>
Serving HTTP on <span class="token number">0.0</span>.0.0 port <span class="token number">9000</span> <span class="token punctuation">(</span>http://0.0.0.0:9000/<span class="token punctuation">)</span> <span class="token punctuation">..</span>.
</code></pre></div>
</li>
<li>
<p>Create a simple prometheus scrape config in a file called <code>scrape.yml</code></p>
<div class="remark-highlight"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 5s
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 5s

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">"prometheus"</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"localhost:9000"</span><span class="token punctuation">]</span>
</code></pre></div>
</li>
<li>
<p>Get the remote write URL for the prometheus storage</p>
</li>
<li>
<p>Run <code>vmagent</code> with the below command. This should start inserting the above data into the storage every 5 seconds. The timestamp used will be the time at which the scrape happens (time observed)</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">$ vmagent <span class="token parameter variable">--promscrape.config</span><span class="token operator">=</span>scrape.yml <span class="token punctuation">\</span>
	<span class="token parameter variable">--promscrape.config.strictParse</span> <span class="token boolean">false</span> <span class="token punctuation">\</span>
	<span class="token parameter variable">--remoteWrite.url</span> <span class="token operator">&#x3C;</span>remote_write_url<span class="token operator">></span>
</code></pre></div>
</li>
</ol>
</body></html></article></div><footer class="text-center text-gray-500 text-sm mt-5 pb-2">Built from scratch with <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://nextjs.org/">Next.js</a> and <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://tailwindcss.com/">Tailwind CSS</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"remote-write-dummy-metrics","contentHTML":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003cp\u003eWhile working on any system built on top of prometheus based storage, you might\nwant to use dummy data for testing. But prometheus based storages (prometheus,\nvictoriaMetrics, m3db etc) don’t support “insert” queries like SQL. So, this\ndoc will walk you through how to remote_write data into prometheus without\nhaving to write any code\u003c/p\u003e\n\u003ch2 id=\"setup\"\u003e\u003ca class=\"anchor\" href=\"#setup\"\u003eSetup\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eMake sure you have a tool that can spin up a simple HTTP server that can serve static files. \u003ccode\u003epython\u003c/code\u003e also will do\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInstall any prometheus based remote write agent\u003c/p\u003e\n\u003cp\u003eFor \u003ccode\u003evmagent\u003c/code\u003e, you can download the latest version of \u003ccode\u003evimutils\u003c/code\u003e from this\n\u003ca href=\"https://github.com/VictoriaMetrics/VictoriaMetrics/releases\"\u003egithub release page\u003c/a\u003e,\nunarchive it and place the \u003ccode\u003evmagent\u003c/code\u003e binary in your system PATH\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"steps\"\u003e\u003ca class=\"anchor\" href=\"#steps\"\u003eSteps\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eCreate a file called \u003ccode\u003emetrics\u003c/code\u003e with the below contents. This is the dummy data we will be inserting into the storage. This is in the \u003cstrong\u003eOpen metrics format\u003c/strong\u003e everyone is talking about\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003erequest_count{tag_namespace=\u0026#x26;quot;alpha\u0026#x26;quot;, region=\u0026#x26;quot;ap-south-1\u0026#x26;quot;} 30\nrequest_count{tag_namespace=\u0026#x26;quot;beta\u0026#x26;quot;, region=\u0026#x26;quot;ap-south-1\u0026#x26;quot;} 20\nrequest_count{tag_namespace=\u0026#x26;quot;gamma\u0026#x26;quot;, region=\u0026#x26;quot;ap-south-1\u0026#x26;quot;} 10\nrequest_count{tag_namespace=\u0026#x26;quot;gamma\u0026#x26;quot;, region=\u0026#x26;quot;us-east-1\u0026#x26;quot;} 10\nerror{tag_namespace=\u0026#x26;quot;alpha\u0026#x26;quot;, region=\u0026#x26;quot;ap-south-1\u0026#x26;quot;} 1\nerror{tag_namespace=\u0026#x26;quot;beta\u0026#x26;quot;, region=\u0026#x26;quot;ap-south-1\u0026#x26;quot;} 0\nerror{tag_namespace=\u0026#x26;quot;gamma\u0026#x26;quot;, region=\u0026#x26;quot;us-east-1\u0026#x26;quot;} 4\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRun an HTTP server that can server this file on \u003ccode\u003e/metrics\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ \u003cspan class=\"token builtin class-name\"\u003ecd\u003c/span\u003e to/dir/containing/above/file\n$ python \u003cspan class=\"token parameter variable\"\u003e-m\u003c/span\u003e http.server \u003cspan class=\"token number\"\u003e9000\u003c/span\u003e\nServing HTTP on \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e.0.0 port \u003cspan class=\"token number\"\u003e9000\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ehttp://0.0.0.0:9000/\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003e.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate a simple prometheus scrape config in a file called \u003ccode\u003escrape.yml\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yml\"\u003e\u003ccode class=\"language-yml\"\u003e\u003cspan class=\"token key atrule\"\u003eglobal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token key atrule\"\u003escrape_interval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e 5s\n  \u003cspan class=\"token key atrule\"\u003eevaluation_interval\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e 5s\n\n\u003cspan class=\"token key atrule\"\u003escrape_configs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ejob_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"prometheus\"\u003c/span\u003e\n    \u003cspan class=\"token key atrule\"\u003estatic_configs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003etargets\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"localhost:9000\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eGet the remote write URL for the prometheus storage\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRun \u003ccode\u003evmagent\u003c/code\u003e with the below command. This should start inserting the above data into the storage every 5 seconds. The timestamp used will be the time at which the scrape happens (time observed)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e$ vmagent \u003cspan class=\"token parameter variable\"\u003e--promscrape.config\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003escrape.yml \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n\t\u003cspan class=\"token parameter variable\"\u003e--promscrape.config.strictParse\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e\\\u003c/span\u003e\n\t\u003cspan class=\"token parameter variable\"\u003e--remoteWrite.url\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eremote_write_url\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/body\u003e\u003c/html\u003e","title":"Remote Write Dummy Metrics","date":"2022-08-31"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"remote-write-dummy-metrics"},"buildId":"CvIparCNGMKE8_go-qcJd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>