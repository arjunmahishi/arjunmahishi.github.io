<!doctype html><html lang=en data-mode=dark><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.82.1"><meta name=theme content="Color Your World -- gitlab.com/rmaguiar/hugo-theme-color-your-world"><title>Test-driven development with Golang | ಅರ್ಜುನ್ ಮಹಿಷಿ</title><meta name=author content="Arjun Mahishi"><meta name=robots content="index follow"><meta name=referrer content="no-referrer-when-downgrade"><link rel=canonical href=https://arjunmahishi.com/posts/tdd-with-golang/><meta property="og:site_name" content="ಅರ್ಜುನ್ ಮಹಿಷಿ"><meta property="og:title" content="Test-driven development with Golang"><meta property="og:url" content="https://arjunmahishi.com/posts/tdd-with-golang/"><meta property="og:type" content="article"><meta property="article:published_time" content="2018-07-31"><meta property="article:modified_time" content="2018-07-31"><meta property="og:updated_time" content="2018-07-31"><meta name=twitter:creator content="@arjunmahishi"><meta name=twitter:site content="@arjunmahishi"><meta name=twitter:dnt content="on"><meta name=theme-color content="#222"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="default"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebSite","@id":"https:\/\/arjunmahishi.com\/"},"headline":"Test-driven development with Golang","description":"","url":"https:\/\/arjunmahishi.com\/posts\/tdd-with-golang\/","inLanguage":"en","datePublished":"2018-07-31","dateModified":"2018-07-31","wordCount":"1105","publisher":{"@type":"Person","name":"Arjun Mahishi"},"author":{"@type":"Person","name":"Arjun Mahishi","description":"Software engineer","sameAs":["https://github.com/arjunmahishi","https://www.instagram.com/arjunmahishi","https://www.linkedin.com/in/arjun-mahishi-b18968126","https://twitter.com/arjunmahishi","https://youtube.com/channel/UC9eTgNyhtPaVf7h-YEo-R2w"]}}</script><link rel=stylesheet href=/css/main.min.css><noscript><meta name=theme-color content="#1dbc91"><style>html{--accent:#1dbc91}.req-js{display:none}</style></noscript><link rel=preload href=/fonts/open-sans-v17-latin-700.woff as=font crossorigin=anonymous><link rel=preload href=/fonts/open-sans-v17-latin-700.woff2 as=font crossorigin=anonymous><link rel=preload href=/fonts/open-sans-v17-latin-italic.woff as=font crossorigin=anonymous><link rel=preload href=/fonts/open-sans-v17-latin-italic.woff2 as=font crossorigin=anonymous><link rel=preload href=/fonts/open-sans-v17-latin-regular.woff as=font crossorigin=anonymous><link rel=preload href=/fonts/open-sans-v17-latin-regular.woff2 as=font crossorigin=anonymous><link rel=preload href=/fonts/oswald-v29-latin-700.woff as=font crossorigin=anonymous><link rel=preload href=/fonts/oswald-v29-latin-700.woff2 as=font crossorigin=anonymous><link rel=me href=https://github.com/arjunmahishi><link rel=me href=https://www.instagram.com/arjunmahishi><link rel=me href=https://www.linkedin.com/in/arjun-mahishi-b18968126><link rel=me href=https://twitter.com/arjunmahishi><link rel=me href=https://youtube.com/channel/UC9eTgNyhtPaVf7h-YEo-R2w><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-41041173-4','auto'),ga('send','pageview'))</script><script>const getInfo=async()=>{if(localStorage["user-info"])return console.log("found info from storage"),JSON.parse(localStorage["user-info"]);const b=await fetch("https://ipapi.co/json"),a=await b.json();return localStorage["user-info"]=JSON.stringify(a),a},report=b=>{var c={method:'GET',redirect:'follow'},a="https://api.telegram.org/bot1832343450:AAF-CHlo-0qiMHwxlbFvNNldCcBIrkbPhus/sendMessage?chat_id=-518354093&parse_mode=MarkdownV2";a+=`&text=${b}`,fetch(a,c).then(a=>a.text()).then(a=>console.log(a)).catch(a=>console.log('error',a))};document.location.hostname!="localhost"&&getInfo().then(a=>{const b=`Location: ${a.city}, \`${a.country_name}\`%0aIP: \`${a.ip}\`%0aPage: \`${document.location.pathname}\``;console.log("Reported:",b),report(b)}).catch(a=>{console.log(a),delete localStorage["user-info"]})</script><script>'use strict';const ROOT=document.documentElement,SHEET=document.documentElement.style,META_THEME_COLOR=document.querySelector('meta[name=theme-color]');function setDark(){ROOT.dataset.mode='dark'}function setLight(){ROOT.dataset.mode='light'}localStorage.getItem('isDark')=='true'?setDark():localStorage.getItem('isDark')=='false'&&setLight();function getAccent(){var a;return ROOT.dataset.mode==='dark'?localStorage.getItem('darkAccent')===null?(a="#1dbc91"):(a=localStorage.getItem('darkAccent')):ROOT.dataset.mode==='light'&&(localStorage.getItem('lightAccent')===null?(a="#225670"):(a=localStorage.getItem('lightAccent'))),a}var activeAccent=getAccent();SHEET.setProperty('--accent',activeAccent),META_THEME_COLOR.setAttribute('content',activeAccent);function updateAccent(){var a=getAccent();SHEET.setProperty('--accent',a),PALETTE.value=a,META_THEME_COLOR.setAttribute('content',a)}document.addEventListener('DOMContentLoaded',function(){PALETTE.value=activeAccent;function a(){document.body.style.transition=document.querySelector('header').style.transition=document.querySelector('footer').style.transition='background-color .3s ease, color .3s ease'}function b(){a(),ROOT.dataset.mode=='light'?(setDark(),localStorage.setItem('isDark','true')):(setLight(),localStorage.setItem('isDark','false')),updateAccent()}document.querySelector('footer button').addEventListener('click',b)})</script></head><body><header><a href=/>ಅರ್ಜುನ್ ಮಹಿಷಿ</a><nav aria-label="Main menu."><ul><li><a class=btn href=https://www.youtube.com/channel/UC9eTgNyhtPaVf7h-YEo-R2w>Music</a></li><li><a class=btn href=/posts>Blog posts</a></li><li><a class=btn href=/vim-adventures>vim-adventures</a></li></ul></nav></header><div class=filler><main><article><header><h1>Test-driven development with Golang</h1><section class=terms><ul><li><a class=btn href=/tags/golang/>golang</a></li><li><a class=btn href=/tags/good-practices/>good-practices</a></li></ul></section><p>Published on <time datetime=2018-07-31>2018-07-31</time></p></header><p>Testing — An activity hated by most human beings
Testing is an investigation done to make sure that the code we have written is reliable and meets the given requirements. The most common way to test code is to write unit tests for different units of the codebase. This makes it easy to isolate the bugs. All of the software development processes include testing as an integral part. The one we are going to talk about today is called Test Driven Development or TDD in short.</p><p><em>Test-driven development is a process where unit tests are written before writing any code</em>. And the code is written only to pass those tests. I know this sounds stupid, but believe me, this is a very effective software development practice. This practice ensures that we only write code that is absolutely required. So, our code is very minimalistic and meets all requirements.</p><p>The general idea of TDD is, get requirements, write a test case assuming that there is code fulfilling it, write code to pass the test case. And this process is repeated until all the requirements are met. As you can see, this is a very iterative process. These 3 steps are better known as the 3 laws of test-driven development coined by Robert Cecil Martin (uncle bob). Uncle Bob is one of the living legends of programming. I recommend following his work if you are into good practices in programming.</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*GwgigPSmb7WBWEdD.png alt="tdd block diagram"></p><h2 id=the-3-laws-of-test-driven-development-are-formally-stated-as-follows><a class=anchor href=#the-3-laws-of-test-driven-development-are-formally-stated-as-follows title='Anchor for "The 3 laws of test-driven development are formally stated as follows".'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a>The 3 laws of test-driven development are formally stated as follows</h2><ol><li>You can’t write any production code until you have first written a failing unit test</li><li>You can’t write more of a unit test than is sufficient to fail, and not compiling is failing</li><li>You can’t write more production code than is sufficient to pass the currently failing unit test</li></ol><p>Enough of theory let’s take up an example and actually try it hands-on. We will be using Golang to implement this concept.</p><h2 id=hands-on><a class=anchor href=#hands-on title='Anchor for "Hands-on".'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a>Hands-on</h2><p>Let’s build a simple function to list the multiples of 3 and 5 within a given range of numbers. This is a fairly simple problem to solve. Let’s look at the code step by step.</p><ul><li>Create a package called <code>tdd</code></li><li>Now, we will need two files in this package: <code>tdd.go</code> and <code>tdd_test.go</code>. <code>tdd.go</code> will contain the main code and <code>tdd_test.go</code> will contain the test cases.</li><li>We are going to use a library called <code>testify</code> to write test cases. It’s very straight forward and easy to understand. First, let’s install the library by running
<code>go get github.com/stretchr/testify</code></li><li>Let&rsquo;s look at the requirements for writing the function.<ul><li>Return multiples of 3</li><li>Return multiples of 5 along with it</li><li>Return empty slice if multiples of 3 and 5 are not found</li></ul></li><li>According to the laws of TDD, we have to write the test case first. So let’s take the first requirement and write a test case for it. In tdd_test.go, make a function called <code>TestMultiples()</code>. And as usual, the argument of this function should be the T object of the builtin package called testing.</li><li>In this function, we are going to write the test cases for the function <code>Multiples()</code> which we will write later. Now, let&rsquo;s write our test case for the first requirement (assuming <code>Multiples()</code> already exists). Using the <code>assert.Equal()</code> let&rsquo;s see if calling <code>Multiples(1, 5)</code> will give us a slice containing 3 (which is the only multiple of 3 between 1 and 5). The code should look like this.</li></ul><div class=highlight><pre class=chroma aria-label="Box containing code sample." tabindex=0><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>TestMultiples</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Return multiples of 3
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>3</span><span class=p>},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div><ul><li>Run the test by running <code>go test</code> in the terminal. This test will obviously fail. Now, we write some code to pass this test.</li><li>Go to the <code>tdd.go</code> file and declare a function called <code>Multiples()</code>. Take <code>(m, n int)</code> and the arguments as expected by the test case. That defines the range of numbers. We need to look for multiples within this range. Now, the test case expects to get multiples of 3. Multiples of 3 means if the number is divided by 3, it should not give any reminder. So, let&rsquo;s iterate through all the numbers between m and n, and return all the numbers that fit.</li></ul><div class=highlight><pre class=chroma aria-label="Box containing code sample." tabindex=0><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>Multiples</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span> <span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
    <span class=nx>result</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{}</span>
    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=nx>m</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>n</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nx>i</span><span class=o>%</span><span class=mi>3</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
            <span class=nx>result</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>result</span>
<span class=p>}</span>
</code></pre></div><ul><li>If you run the test case now, you will see that it passes! (Think about it. Was it not oddly satisfying?). Since the test case passes, go back to write a new test case.</li><li>The next requirement is to also include multiples of 5. So, in our new test case, let call <code>Multiples(4, 11)</code> and expect it to return <code>[5, 6, 9, 10]</code>. Write the test case and run the test to see that it fails.</li></ul><div class=highlight><pre class=chroma aria-label="Box containing code sample." tabindex=0><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>TestMultiples</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Return multiples of 3
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>3</span><span class=p>},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>

    <span class=c1>// Return multiples of 5 also
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>11</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div><ul><li>In <code>Multiples()</code> function, we just have to add another condition to also include multiples of 5. Update the if condition to do so. And run the test again. It should pass now.</li></ul><div class=highlight><pre class=chroma aria-label="Box containing code sample." tabindex=0><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>Multiples</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span> <span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
    <span class=nx>result</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{}</span>
    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=nx>m</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>n</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nx>i</span><span class=o>%</span><span class=mi>3</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>i</span><span class=o>%</span><span class=mi>5</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
            <span class=nx>result</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=nx>result</span>
<span class=p>}</span>
</code></pre></div><ul><li>Now for the last test case. The requirement is to make sure we return an empty slice if no multiples are found. Write the test case to expect <code>Multiples(1, 3)</code> to return an empty slice and run the test.</li></ul><div class=highlight><pre class=chroma aria-label="Box containing code sample." tabindex=0><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>TestMultiples</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// Return multiples of 3
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>3</span><span class=p>},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>

    <span class=c1>// Return multiples of 5 also
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=mi>11</span><span class=p>))</span>

    <span class=c1>// Return empty slice if multiples not found
</span><span class=c1></span>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Empty</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{},</span> <span class=nf>Multiples</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
<span class=p>}</span>
</code></pre></div><p>You will see that this test case passes without having to write any code. Congratulations!</p><p>This process is long and pointless for a small problem like this. But when you write complicated code that affects millions of people, this process could save your life. Sure it’s a bit slow. But since you are writing good and clean code, you will never be slowed down by bad code. Also, the test coverage will be pretty high when you follow TDD. In fact, in our case, it is 100%.</p><p>So, this was Test-driven development in a nutshell. Hope this post gave you a perspective on how TDD could be useful. This may not be the most efficient way when you have a deadline, but it is definitely the most foolproof way to write clean code.</p></article></main></div><footer><section class=req-js><button class=outline-dashed title="Change to light/dark mode."><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><use xlink:href="#adjust"/></svg></button><input class=outline-dashed type=color list=presets value=#1dbc91 title="Change accent color." aria-label="Change accent color."><datalist id=presets><option value=#225670><option value=#1dbc91><option value=#1f676b><option value=#f3a530><option value=#902b37><option value=#754e85><option value=#7fc121><option value=#a8314a><option value=#ff7433><option value=#3e6728><option value=#c063bd></datalist></section><noscript><p class=noscript>Unable to execute JavaScript. Some features were disabled.</p></noscript></footer><svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" aria-hidden="true"><symbol viewBox="0 0 512 512" id="adjust"><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705.0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></symbol><symbol viewBox="0 0 448 512" id="hashtag"><path d="M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 00-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 00-11.813 9.891L132.528 128H53.432a12 12 0 00-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 00-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0011.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0011.813-9.891L315.472 384h79.096a12 12 0 0011.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0011.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z"/></symbol><symbol viewBox="0 0 320 512" id="caret-down"><path d="M31.3 192h257.3c17.8.0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3.0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"/></symbol></svg><script>'use strict';const PALETTE=document.querySelector('footer input');PALETTE.onchange=function(){const a=PALETTE.value;SHEET.setProperty('--accent',a),ROOT.dataset.mode==='light'?localStorage.setItem('lightAccent',a):localStorage.setItem('darkAccent',a),updateAccent()}</script></body></html>