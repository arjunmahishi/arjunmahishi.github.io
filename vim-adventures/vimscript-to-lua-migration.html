<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Rewriting my existing neovim config in lua | Arjun Mahishi</title><link rel="icon" href="/favicon.ico"/><meta name="description" content="Arjun Mahishi&#x27;s personal website"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-okaidia.css" as="script"/><link href="/gruvbox.css" rel="stylesheet"/><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/c1eca20d0d13c49d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c1eca20d0d13c49d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-481ef0d25a716735.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8eb925bbcba34840.js" defer=""></script><script src="/_next/static/chunks/996-502a5e68cb1e9d91.js" defer=""></script><script src="/_next/static/chunks/pages/vim-adventures/%5Bid%5D-a3f25a8afb63f38a.js" defer=""></script><script src="/_next/static/0phKXXAWr_Jkmh4rwhU7p/_buildManifest.js" defer=""></script><script src="/_next/static/0phKXXAWr_Jkmh4rwhU7p/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="grid place-items-center"><nav class="flex flex-col lg:flex-row lg:w-2/3 place-items-center lg:place-items-start"><div class="text-2xl"><a class="underline decoration-2 underline-offset-4" href="/">ಅರ್ಜುನ್ ಮಹಿಷಿ</a></div><div class="flex grow justify-end mt-2 lg:mt-0"><ul class="p-1"><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/about">About</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/projects">Projects</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/posts">Blog</a></li><li class="mx-2 inline-block align-text-bottom"><a class="underline underline-offset-4 decoration-2" href="/vim-adventures">Vim-Adventures</a></li></ul></div></nav><article class="prose lg:max-w-2xl lg:prose-lg px-8 m-auto my-4 sm:my-16 prose-img:rounded-xl"><h1>Rewriting my existing neovim config in lua</h1>
<p>I've been wanting to rewrite my neovim config in Lua for a really long time. I didn't really know why. Just wanted to do it. Lua has a more sane and intuitive syntax compared to vimscript. So, it ends up being easier to maintain, refactor and extend. Plus, I think the entire neovim community is moving forward in this direction. I am hearing good things about vimscript in vim9, but maybe that will be an opportunity for another such blog post.</p>
<p>This blog post is for you if you are thinking to move to lua but didn't know where to start or haven't thought about moving to lua yet or even if you just enjoy the occasional vim-related content.</p>
<h3>Do you need to be a lua expert?</h3>
<p>Absolutely not, even after rewriting my entire config in lua, I still don't know even the most basic things like iterating over a list, creating a class (if classes are even there), etc. If you know basic programming and have gone through someone else's code before, you are good to go.</p>
<h3>Some basic lua to help get started</h3>
<p>Here are some of the things you will encounter</p>
<p>Function syntax</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">func_name</span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">"epic things"</span>
<span class="token keyword">end</span>

func_name <span class="token string">'arg1 value'</span> <span class="token comment">-- like ruby</span>
</code></pre></div>
<p>Array syntax</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">arr1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span>
arr2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Map syntax (called tables in lua)</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">tb1 <span class="token operator">=</span> <span class="token punctuation">{</span> key1 <span class="token operator">=</span> <span class="token string">'val1'</span><span class="token punctuation">,</span> key2 <span class="token operator">=</span> <span class="token string">'val2'</span> <span class="token punctuation">}</span>
<span class="token function">print</span><span class="token punctuation">(</span>tb1<span class="token punctuation">.</span>key2<span class="token punctuation">)</span>
</code></pre></div>
<p>Syntax to run vim script (required as not everything is supported yet in lua)</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua"><span class="token comment">-- inline</span>
vim<span class="token punctuation">.</span>cmd <span class="token operator">=</span> <span class="token string">"echo 'hello world'"</span>

<span class="token comment">-- multi-line</span>
vim<span class="token punctuation">.</span>cmd <span class="token string">[[</span>
<span class="token string">  echo 'hello world'</span>
<span class="token string">  echo 'can't think of a better example'</span>
<span class="token string">]]</span>

<span class="token comment">-- NOTE: multi-line strings in lua are defined with </span>
<span class="token comment">-- double square brackets `[[]]`</span>
</code></pre></div>
<h3>Deep dive</h3>
<h5>Structure of the config file</h5>
<blockquote>
<p>The lua config is kept in a file called <code>init.lua</code> in the <code>~/.config/nvim</code> directory (just like <code>init.vim</code>)</p>
</blockquote>
<p>So far, I've kept the entire config in one file. This is mainly to make it more sharable. All you have to do to use my config is, copy-paste the entire file and run <code>vim +PlugInstall</code>. But this is not necessary. You can choose to organize it in separate files. In VimConf 2021, there was a speaker who maintained a separate file for configuring each plugin.</p>
<p>My config is divided into several blocks:</p>
<ol>
<li>Plugins -- declare all the plugins with vim-plug</li>
<li>Basic vim settings -- these are the basic editor settings like enabling relative numbering, disabling highlighting, etc</li>
<li>Custom key mapping -- this is my favorite section, where all the remaps live</li>
<li>The remaining blocks are dedicated to individual plugin config</li>
</ol>
<h5>Basic settings</h5>
<p>I have a bunch of settings that enable/disable vim features, set stuff, etc. Translating these to lua is very easy. Lua exposes each setting as a member of the <code>vim.opt</code>. So, setting the relative numbering would be <code>vim.opt.relativenumber = true</code>.</p>
<p><strong>More examples</strong></p>
<p>vimscript</p>
<div class="remark-highlight"><pre class="language-vim"><code class="language-vim"><span class="token keyword">set</span> relativenumber
<span class="token keyword">set</span> <span class="token keyword">number</span>
<span class="token keyword">set</span> <span class="token builtin">incsearch</span>
<span class="token keyword">set</span> colorcolumn<span class="token operator">=</span><span class="token number">121</span>
<span class="token keyword">set</span> <span class="token builtin">mouse</span><span class="token operator">=</span>a
</code></pre></div>
<p>the lua equalent</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>relativenumber <span class="token operator">=</span> <span class="token keyword">true</span>
vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token keyword">true</span>
vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>incsearch <span class="token operator">=</span> <span class="token keyword">true</span>
vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>colorcolumn <span class="token operator">=</span> <span class="token string">'121'</span>
vim<span class="token punctuation">.</span>opt<span class="token punctuation">.</span>mouse <span class="token operator">=</span> <span class="token string">'a'</span>
</code></pre></div>
<p>Similarly translated all the settings</p>
<p>Some things like <code>syntax enable</code> and <code>colorscheme onedark</code> were not available. So, I had to use inline vim script</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>cmd <span class="token string">'syntax enable'</span>
vim<span class="token punctuation">.</span>cmd <span class="token string">'colorscheme onedark'</span>
</code></pre></div>
<h5>Custom key mapping</h5>
<p>Like the settings, key mappings are also pretty easy. Lua provides the function <code>vim.api.nvim_set_keymap</code> to set custom key mapping. This function takes the mode, key, commands, etc as arguments.</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua"><span class="token comment">-- global variables are modified like this</span>
vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>mapleader <span class="token operator">=</span> <span class="token string">' '</span>

<span class="token comment">-- assign the function to a variable called map (cleaner)</span>
<span class="token keyword">local</span> map <span class="token operator">=</span> vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span>nvim_set_keymap
<span class="token comment">-- define a table with noremap as true, which can be used for some of the mappings</span>
<span class="token keyword">local</span> noremap <span class="token operator">=</span> <span class="token punctuation">{</span> noremap <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span>

<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'vv'</span><span class="token punctuation">,</span> <span class="token string">':vsplit&#x3C;CR> l'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'tt'</span><span class="token punctuation">,</span> <span class="token string">':tabnew&#x3C;CR>'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;leader>h'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;c-w>h'</span><span class="token punctuation">,</span> noremap<span class="token punctuation">)</span>
<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;leader>j'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;c-w>j'</span><span class="token punctuation">,</span> noremap<span class="token punctuation">)</span>
<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;leader>k'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;c-w>k'</span><span class="token punctuation">,</span> noremap<span class="token punctuation">)</span>
<span class="token function">map</span><span class="token punctuation">(</span><span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;leader>l'</span><span class="token punctuation">,</span> <span class="token string">'&#x3C;c-w>l'</span><span class="token punctuation">,</span> noremap<span class="token punctuation">)</span>
</code></pre></div>
<p>The 'n' you see as the first arguement stands for <em>normal mode</em>. You can also have  'i' (insert), 'v' (visual) and 't' (terminal)</p>
<p><code>autocmd</code> is still not supported in lua. So, they need to be defined in vimscript</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>cmd <span class="token string">[[</span>
<span class="token string">  au filetype json nmap &#x3C;leader>f :%!jq '.' %&#x3C;CR></span>
<span class="token string">  au filetype hcl nmap &#x3C;leader>f :%!hclfmt %&#x3C;CR></span>
<span class="token string">]]</span>
</code></pre></div>
<p>(FYI: I've written <a href="https://arjunmahishi.com/vim-adventures/prettify-json/">a blog post</a> that explains the above commands)</p>
<h5>Configuring plugins</h5>
<p>Most of my plugin config involved setting global values and key mappings. As mentioned earlier, vim global values are set in lua using <code>vim.g.&#x3C;var name></code></p>
<p>vim config</p>
<div class="remark-highlight"><pre class="language-vim"><code class="language-vim"><span class="token keyword">let</span> g<span class="token punctuation">:</span>go_highlight_fields <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>go_highlight_functions <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>go_highlight_function_calls <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>go_highlight_operators <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>go_fmt_command <span class="token operator">=</span> <span class="token string">"goimports"</span>
</code></pre></div>
<p>lua equalent</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>go_highlight_fields <span class="token operator">=</span> <span class="token number">1</span>
vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>go_highlight_functions <span class="token operator">=</span> <span class="token number">1</span>
vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>go_highlight_function_calls <span class="token operator">=</span> <span class="token number">1</span>
vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>go_highlight_operators <span class="token operator">=</span> <span class="token number">1</span>
vim<span class="token punctuation">.</span>g<span class="token punctuation">.</span>go_fmt_command <span class="token operator">=</span> <span class="token string">"goimports"</span>
</code></pre></div>
<p>If the config is complicated for any plugin, just dump it in <code>vim.cmd [[]]</code> :P</p>
<p>If the plugin was written in lua, it will usually have a setup function that you can call. Example:</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">require<span class="token string">'nvim-treesitter.configs'</span><span class="token punctuation">.</span><span class="token function">setup</span> <span class="token punctuation">{</span>
  ensure_installed <span class="token operator">=</span> <span class="token string">"maintained"</span><span class="token punctuation">,</span>
  highlight <span class="token operator">=</span> <span class="token punctuation">{</span>
    enable <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    additional_vim_regex_highlighting <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h3>That's it!</h3>
<p>Wasn't very complecated was it?</p>
<p>You can also have a hybrid config -- using both vimscript and lua. All you have to do is, create a new file to keep your vimscript in and import it in the <code>init.lua</code> file. I had done this for my coc config (until I stopped using it)</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>cmd <span class="token string">'runtime! coc-config.vim'</span>
</code></pre></div>
<p>I am not entirely sure if doing this is worth your time. So don't do this in the middle of work or if you are busy with something more important. For me, this was triggered by boredom + the Diwali holidays. Hope this helps.</p>
<p><a href="https://github.com/arjunmahishi/dotfiles/blob/e6db1db76ff5f886ddd7f91e830117e471078e07/common/init.lua">This</a> is my final <code>init.lua</code> at the time of writing this post (the link is to a specific commit)</p>
</article></div><footer class="text-center text-gray-500 text-sm mt-5 pb-2">Built from scratch with <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://nextjs.org/">Next.js</a> and <!-- --> <a class="underline decoration-dashed underline-offset-4 decoration-2" href="https://tailwindcss.com/">Tailwind CSS</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"vimscript-to-lua-migration","contentHTML":"\u003ch1\u003eRewriting my existing neovim config in lua\u003c/h1\u003e\n\u003cp\u003eI've been wanting to rewrite my neovim config in Lua for a really long time. I didn't really know why. Just wanted to do it. Lua has a more sane and intuitive syntax compared to vimscript. So, it ends up being easier to maintain, refactor and extend. Plus, I think the entire neovim community is moving forward in this direction. I am hearing good things about vimscript in vim9, but maybe that will be an opportunity for another such blog post.\u003c/p\u003e\n\u003cp\u003eThis blog post is for you if you are thinking to move to lua but didn't know where to start or haven't thought about moving to lua yet or even if you just enjoy the occasional vim-related content.\u003c/p\u003e\n\u003ch3\u003eDo you need to be a lua expert?\u003c/h3\u003e\n\u003cp\u003eAbsolutely not, even after rewriting my entire config in lua, I still don't know even the most basic things like iterating over a list, creating a class (if classes are even there), etc. If you know basic programming and have gone through someone else's code before, you are good to go.\u003c/p\u003e\n\u003ch3\u003eSome basic lua to help get started\u003c/h3\u003e\n\u003cp\u003eHere are some of the things you will encounter\u003c/p\u003e\n\u003cp\u003eFunction syntax\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003e\u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003efunc_name\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003earg1\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"epic things\"\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eend\u003c/span\u003e\n\nfunc_name \u003cspan class=\"token string\"\u003e'arg1 value'\u003c/span\u003e \u003cspan class=\"token comment\"\u003e-- like ruby\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eArray syntax\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003earr1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\narr2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'b'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'c'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003earr1\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eMap syntax (called tables in lua)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003etb1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e key1 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'val1'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e key2 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'val2'\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etb1\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ekey2\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSyntax to run vim script (required as not everything is supported yet in lua)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003e\u003cspan class=\"token comment\"\u003e-- inline\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"echo 'hello world'\"\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e-- multi-line\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token string\"\u003e[[\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e  echo 'hello world'\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e  echo 'can't think of a better example'\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e]]\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e-- NOTE: multi-line strings in lua are defined with \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e-- double square brackets `[[]]`\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eDeep dive\u003c/h3\u003e\n\u003ch5\u003eStructure of the config file\u003c/h5\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe lua config is kept in a file called \u003ccode\u003einit.lua\u003c/code\u003e in the \u003ccode\u003e~/.config/nvim\u003c/code\u003e directory (just like \u003ccode\u003einit.vim\u003c/code\u003e)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eSo far, I've kept the entire config in one file. This is mainly to make it more sharable. All you have to do to use my config is, copy-paste the entire file and run \u003ccode\u003evim +PlugInstall\u003c/code\u003e. But this is not necessary. You can choose to organize it in separate files. In VimConf 2021, there was a speaker who maintained a separate file for configuring each plugin.\u003c/p\u003e\n\u003cp\u003eMy config is divided into several blocks:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ePlugins -- declare all the plugins with vim-plug\u003c/li\u003e\n\u003cli\u003eBasic vim settings -- these are the basic editor settings like enabling relative numbering, disabling highlighting, etc\u003c/li\u003e\n\u003cli\u003eCustom key mapping -- this is my favorite section, where all the remaps live\u003c/li\u003e\n\u003cli\u003eThe remaining blocks are dedicated to individual plugin config\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5\u003eBasic settings\u003c/h5\u003e\n\u003cp\u003eI have a bunch of settings that enable/disable vim features, set stuff, etc. Translating these to lua is very easy. Lua exposes each setting as a member of the \u003ccode\u003evim.opt\u003c/code\u003e. So, setting the relative numbering would be \u003ccode\u003evim.opt.relativenumber = true\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eMore examples\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003evimscript\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-vim\"\u003e\u003ccode class=\"language-vim\"\u003e\u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e relativenumber\n\u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enumber\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eincsearch\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e colorcolumn\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e121\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emouse\u003c/span\u003e\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ea\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ethe lua equalent\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003evim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eopt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelativenumber \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eopt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enumber \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eopt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eincsearch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eopt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecolorcolumn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'121'\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eopt\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emouse \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'a'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSimilarly translated all the settings\u003c/p\u003e\n\u003cp\u003eSome things like \u003ccode\u003esyntax enable\u003c/code\u003e and \u003ccode\u003ecolorscheme onedark\u003c/code\u003e were not available. So, I had to use inline vim script\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003evim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token string\"\u003e'syntax enable'\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token string\"\u003e'colorscheme onedark'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch5\u003eCustom key mapping\u003c/h5\u003e\n\u003cp\u003eLike the settings, key mappings are also pretty easy. Lua provides the function \u003ccode\u003evim.api.nvim_set_keymap\u003c/code\u003e to set custom key mapping. This function takes the mode, key, commands, etc as arguments.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003e\u003cspan class=\"token comment\"\u003e-- global variables are modified like this\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emapleader \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e' '\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e-- assign the function to a variable called map (cleaner)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elocal\u003c/span\u003e map \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eapi\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003envim_set_keymap\n\u003cspan class=\"token comment\"\u003e-- define a table with noremap as true, which can be used for some of the mappings\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elocal\u003c/span\u003e noremap \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e noremap \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'vv'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e':vsplit\u0026#x3C;CR\u003e l'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'tt'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e':tabnew\u0026#x3C;CR\u003e'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;leader\u003eh'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;c-w\u003eh'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e noremap\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;leader\u003ej'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;c-w\u003ej'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e noremap\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;leader\u003ek'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;c-w\u003ek'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e noremap\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token function\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'n'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;leader\u003el'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'\u0026#x3C;c-w\u003el'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e noremap\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe 'n' you see as the first arguement stands for \u003cem\u003enormal mode\u003c/em\u003e. You can also have  'i' (insert), 'v' (visual) and 't' (terminal)\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eautocmd\u003c/code\u003e is still not supported in lua. So, they need to be defined in vimscript\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003evim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token string\"\u003e[[\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e  au filetype json nmap \u0026#x3C;leader\u003ef :%!jq '.' %\u0026#x3C;CR\u003e\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e  au filetype hcl nmap \u0026#x3C;leader\u003ef :%!hclfmt %\u0026#x3C;CR\u003e\u003c/span\u003e\n\u003cspan class=\"token string\"\u003e]]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e(FYI: I've written \u003ca href=\"https://arjunmahishi.com/vim-adventures/prettify-json/\"\u003ea blog post\u003c/a\u003e that explains the above commands)\u003c/p\u003e\n\u003ch5\u003eConfiguring plugins\u003c/h5\u003e\n\u003cp\u003eMost of my plugin config involved setting global values and key mappings. As mentioned earlier, vim global values are set in lua using \u003ccode\u003evim.g.\u0026#x3C;var name\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003evim config\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-vim\"\u003e\u003ccode class=\"language-vim\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e g\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003ego_highlight_fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e g\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003ego_highlight_functions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e g\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003ego_highlight_function_calls \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e g\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003ego_highlight_operators \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e g\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003ego_fmt_command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"goimports\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003elua equalent\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003evim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ego_highlight_fields \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ego_highlight_functions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ego_highlight_function_calls \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ego_highlight_operators \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\nvim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ego_fmt_command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"goimports\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf the config is complicated for any plugin, just dump it in \u003ccode\u003evim.cmd [[]]\u003c/code\u003e :P\u003c/p\u003e\n\u003cp\u003eIf the plugin was written in lua, it will usually have a setup function that you can call. Example:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003erequire\u003cspan class=\"token string\"\u003e'nvim-treesitter.configs'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetup\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  ensure_installed \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"maintained\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  highlight \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    enable \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    additional_vim_regex_highlighting \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003eThat's it!\u003c/h3\u003e\n\u003cp\u003eWasn't very complecated was it?\u003c/p\u003e\n\u003cp\u003eYou can also have a hybrid config -- using both vimscript and lua. All you have to do is, create a new file to keep your vimscript in and import it in the \u003ccode\u003einit.lua\u003c/code\u003e file. I had done this for my coc config (until I stopped using it)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003evim\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecmd \u003cspan class=\"token string\"\u003e'runtime! coc-config.vim'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI am not entirely sure if doing this is worth your time. So don't do this in the middle of work or if you are busy with something more important. For me, this was triggered by boredom + the Diwali holidays. Hope this helps.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/arjunmahishi/dotfiles/blob/e6db1db76ff5f886ddd7f91e830117e471078e07/common/init.lua\"\u003eThis\u003c/a\u003e is my final \u003ccode\u003einit.lua\u003c/code\u003e at the time of writing this post (the link is to a specific commit)\u003c/p\u003e\n","title":"Rewriting my existing neovim config in lua","date":"2021-11-05","tags":["vim"]}},"__N_SSG":true},"page":"/vim-adventures/[id]","query":{"id":"vimscript-to-lua-migration"},"buildId":"0phKXXAWr_Jkmh4rwhU7p","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>