{"pageProps":{"postData":{"id":"remote-write-dummy-metrics","contentHTML":"<html><head></head><body><p>While working on any system built on top of prometheus based storage, you might\nwant to use dummy data for testing. But prometheus based storages (prometheus,\nvictoriaMetrics, m3db etc) don’t support “insert” queries like SQL. So, this\ndoc will walk you through how to remote_write data into prometheus without\nhaving to write any code</p>\n<h2 id=\"setup\"><a class=\"anchor\" href=\"#setup\">Setup</a></h2>\n<ol>\n<li>\n<p>Make sure you have a tool that can spin up a simple HTTP server that can serve static files. <code>python</code> also will do</p>\n</li>\n<li>\n<p>Install any prometheus based remote write agent</p>\n<p>For <code>vmagent</code>, you can download the latest version of <code>vimutils</code> from this\n<a href=\"https://github.com/VictoriaMetrics/VictoriaMetrics/releases\">github release page</a>,\nunarchive it and place the <code>vmagent</code> binary in your system PATH</p>\n</li>\n</ol>\n<h2 id=\"steps\"><a class=\"anchor\" href=\"#steps\">Steps</a></h2>\n<ol>\n<li>\n<p>Create a file called <code>metrics</code> with the below contents. This is the dummy data we will be inserting into the storage. This is in the <strong>Open metrics format</strong> everyone is talking about</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">request_count{tag_namespace=&#x26;quot;alpha&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 30\nrequest_count{tag_namespace=&#x26;quot;beta&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 20\nrequest_count{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 10\nrequest_count{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;us-east-1&#x26;quot;} 10\nerror{tag_namespace=&#x26;quot;alpha&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 1\nerror{tag_namespace=&#x26;quot;beta&#x26;quot;, region=&#x26;quot;ap-south-1&#x26;quot;} 0\nerror{tag_namespace=&#x26;quot;gamma&#x26;quot;, region=&#x26;quot;us-east-1&#x26;quot;} 4</code></pre></div>\n</li>\n<li>\n<p>Run an HTTP server that can server this file on <code>/metrics</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> to/dir/containing/above/file\n$ python <span class=\"token parameter variable\">-m</span> http.server <span class=\"token number\">9000</span>\nServing HTTP on <span class=\"token number\">0.0</span>.0.0 port <span class=\"token number\">9000</span> <span class=\"token punctuation\">(</span>http://0.0.0.0:9000/<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.\n</code></pre></div>\n</li>\n<li>\n<p>Create a simple prometheus scrape config in a file called <code>scrape.yml</code></p>\n<div class=\"remark-highlight\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">global</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">scrape_interval</span><span class=\"token punctuation\">:</span> 5s\n  <span class=\"token key atrule\">evaluation_interval</span><span class=\"token punctuation\">:</span> 5s\n\n<span class=\"token key atrule\">scrape_configs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"prometheus\"</span>\n    <span class=\"token key atrule\">static_configs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">targets</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"localhost:9000\"</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n</li>\n<li>\n<p>Get the remote write URL for the prometheus storage</p>\n</li>\n<li>\n<p>Run <code>vmagent</code> with the below command. This should start inserting the above data into the storage every 5 seconds. The timestamp used will be the time at which the scrape happens (time observed)</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">$ vmagent <span class=\"token parameter variable\">--promscrape.config</span><span class=\"token operator\">=</span>scrape.yml <span class=\"token punctuation\">\\</span>\n\t<span class=\"token parameter variable\">--promscrape.config.strictParse</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token parameter variable\">--remoteWrite.url</span> <span class=\"token operator\">&#x3C;</span>remote_write_url<span class=\"token operator\">></span>\n</code></pre></div>\n</li>\n</ol>\n</body></html>","title":"Remote Write Dummy Metrics","date":"2022-08-31"}},"__N_SSG":true}